{% extends "base.html" %}

{% block header_info %}
{% endblock %}

{% block header_actions %}
{% endblock %}

{% block content %}
<div class="dashboard-page">
    <div class="dashboard-header">
        <h1 class="dashboard-title">管理员后台</h1>
        <div class="dashboard-actions">
            <a href="{{ url_for('add_it') }}" class="btn btn-primary">添加新IT</a>
            <a href="{{ url_for('export_csv') }}" class="btn btn-success">导出CSV</a>
            <form action="{{ url_for('import_csv') }}" method="POST" enctype="multipart/form-data" class="inline-form">
                <input type="file" name="file" accept=".csv" id="csv-file-input" style="display: none;">
                <button type="submit" class="btn btn-info" onclick="document.getElementById('csv-file-input').click(); return false;" id="import-btn">导入CSV</button>
            </form>
        </div>
    </div>
    <div class="dashboard-content">
        <h2>所有不可能三角 ({{ its|length }})</h2>
        
        {% if its %}
            <div class="table-container">
                <table class="data-table dense">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>名称</th>
                            <th>创建者</th>
                            <th>领域</th>
                            <th>元素1</th>
                            <th>元素2</th>
                            <th>元素3</th>
                            <th>赞同</th>
                            <th>评论</th>
                            <th>创建时间</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for it in its %}
                            <tr>
                                <td>{{ it.id }}</td>
                                <td>
                                    <a href="{{ url_for('detail', id=it.id) }}" class="table-link">{{ it.name }}</a>
                                </td>
                                <td>{{ it.creator.username }}</td>
                                <td>{{ it.field }}</td>
                                <td>{{ it.element1 }}</td>
                                <td>{{ it.element2 }}</td>
                                <td>{{ it.element3 }}</td>
                                <td>{{ it.agree_count }}</td>
                                <td>{{ it.comments|length }}</td>
                                <td>{{ it.created_at.strftime('%Y-%m-%d') }}</td>
                                <td>
                                    <a href="{{ url_for('edit_it', id=it.id) }}" class="btn-small btn-edit">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                        </svg>
                                        编辑
                                    </a>
                                    <form action="{{ url_for('delete_it', id=it.id) }}" method="POST" class="inline-form">
                                        <button type="submit" class="btn-small btn-delete" onclick="return confirm('确定删除？')">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                            </svg>
                                            删除
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="empty-state">
                <p>系统中没有任何不可能三角数据</p>
                <a href="{{ url_for('add_it') }}" class="btn btn-primary">创建第一个IT</a>
            </div>
        {% endif %}
    </div>
</div>
{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('csv-file-input');
    const importForm = fileInput.closest('form');
    
    fileInput.addEventListener('change', function(e) {
        if (this.files.length > 0) {
            importForm.submit();
        }
    });
});
</script>
{% endblock %}
{% endblock %}
